I"¨¬<ul id="markdown-toc">
  <li><a href="#æ•°æ®é¢„å¤„ç†pre-processing" id="markdown-toc-æ•°æ®é¢„å¤„ç†pre-processing">æ•°æ®é¢„å¤„ç†ï¼ˆpre-processingï¼‰</a></li>
  <li><a href="#1-å½’ä¸€åŒ–åå½’ä¸€åŒ–" id="markdown-toc-1-å½’ä¸€åŒ–åå½’ä¸€åŒ–">1. å½’ä¸€åŒ–ï¼ˆåå½’ä¸€åŒ–ï¼‰</a></li>
  <li><a href="#2é‡é‡‡æ ·" id="markdown-toc-2é‡é‡‡æ ·">2.é‡é‡‡æ ·</a></li>
  <li><a href="#3æ•°æ®åˆ’åˆ†" id="markdown-toc-3æ•°æ®åˆ’åˆ†">3.æ•°æ®åˆ’åˆ†</a></li>
  <li><a href="#4å„ç§æ»¤æ³¢ä¸­å€¼å‡å€¼å·´ç‰¹æ²ƒæ–¯" id="markdown-toc-4å„ç§æ»¤æ³¢ä¸­å€¼å‡å€¼å·´ç‰¹æ²ƒæ–¯">4.å„ç§æ»¤æ³¢ï¼ˆä¸­å€¼ï¼Œå‡å€¼ï¼Œå·´ç‰¹æ²ƒæ–¯ï¼‰</a></li>
  <li><a href="#5æ•°æ®å¯è§†åŒ–" id="markdown-toc-5æ•°æ®å¯è§†åŒ–">5.æ•°æ®å¯è§†åŒ–</a></li>
  <li><a href="#æ¨¡å‹ç»“æœè¡¡é‡" id="markdown-toc-æ¨¡å‹ç»“æœè¡¡é‡">æ¨¡å‹ç»“æœè¡¡é‡</a></li>
</ul>

<p>â€ƒâ€ƒæœ€è¿‘åœ¨åšæ—¶é—´åºåˆ—çš„é¢„æµ‹é—®é¢˜ï¼Œè¿™é‡Œå°±ç¨å¾®æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä¾¿äºä»¥åæŸ¥é˜…ï¼Œä¹Ÿå¸Œæœ›èƒ½ç»™å¤§å®¶æä¾›åˆ°å¸®åŠ©ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿å¤šå¤šäº¤æµã€‚<br />
â€ƒâ€ƒè¿™æ˜¯ä¸€ä¸ªç³»åˆ—çš„æ–‡ç« ï¼Œä¸»è¦ä»ä»£ç çš„è§’åº¦åˆ†æé—®é¢˜ï¼ˆäº‰å–åšåˆ°ä»£ç ç‰‡æ®µçš„éšç”¨éšå–ï¼‰ï¼Œä¸æ¶‰åŠå¤ªå¤šçš„æ¨¡å‹åŸç†ï¼ˆæˆ‘ä¼šå°½å¯èƒ½è®²ä¸€ä¸‹è‡ªå·±çš„ç†è§£ï¼‰ï¼Œæœ¬ç³»åˆ—æ–‡ç« åŒ…å«äº†æ•°æ®é¢„å¤„ç†å’ŒåŸºæœ¬æ—¶é—´åºåˆ—åˆ†æé¢„æµ‹æ¨¡å‹ï¼š</p>

<p><a href="https://xkw168.github.io/2019/05/20/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B-%E4%B8%80-%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/">ï¼ˆä¸€ï¼‰æ•°æ®é¢„å¤„ç†</a></p>

<p><a href="https://xkw168.github.io/2019/05/20/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B-%E4%BA%8C-AR%E6%A8%A1%E5%9E%8B/">ï¼ˆäºŒï¼‰ARæ¨¡å‹ï¼ˆè‡ªå›å½’æ¨¡å‹ï¼‰</a></p>

<p><a href="https://xkw168.github.io/2019/05/20/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B-%E4%B8%89-Xgboost%E6%A8%A1%E5%9E%8B/">ï¼ˆä¸‰ï¼‰Xgboostæ¨¡å‹</a></p>

<p><a href="https://xkw168.github.io/2019/05/20/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B-%E5%9B%9B-LSTM%E6%A8%A1%E5%9E%8B/">ï¼ˆå››ï¼‰LSTMæ¨¡å‹</a></p>

<p><a href="https://xkw168.github.io/2019/05/20/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%A2%84%E6%B5%8B-%E4%BA%94-Prophet%E6%A8%A1%E5%9E%8B/">ï¼ˆäº”ï¼‰Prophetæ¨¡å‹ï¼ˆè‡ªå›å½’æ¨¡å‹ï¼‰</a></p>

<hr />

<h2 id="æ•°æ®é¢„å¤„ç†pre-processing">æ•°æ®é¢„å¤„ç†ï¼ˆpre-processingï¼‰</h2>

<p>æ•°æ®é¢„å¤„ç†åœ¨æ•°æ®åˆ†æä¸­å æ®äº†é‡è¦çš„åœ°ä½ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»å‡ ç§å¸¸è§çš„é¢„å¤„ç†æ–¹æ³•</p>

<h2 id="1-å½’ä¸€åŒ–åå½’ä¸€åŒ–">1. å½’ä¸€åŒ–ï¼ˆåå½’ä¸€åŒ–ï¼‰</h2>

<p>â€ƒâ€ƒå½’ä¸€åŒ–å¯ä»¥è¯´æ˜¯æ•°æ®é¢„å¤„ç†é‡Œé¢æœ€å¸¸ç”¨çš„æ–¹æ³•ä¹‹ä¸€äº†ï¼Œåœ¨æ¨¡å‹è®­ç»ƒä¸­ä¸åŒçš„æ•°æ®å–å€¼èŒƒå›´å‡å¦‚ç›¸å·®è¿‡å¤§å¾ˆå®¹æ˜“é€ æˆæ¨¡å‹é”™è¯¯çš„åˆ†é…æƒé‡ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™å½’ä¸€åŒ–å¿…ä¸å¯å°‘ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"MinMax"</span><span class="p">,</span> <span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="s">"""
    normalize the data
    :param data: list of data
    :param method: support MinMax scaler or Z-Score scaler
    :param feature_range: use in MinMax scaler
    :return: normalized data(list), scaler
    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># reshape(-1, 1) --&gt; reshape to a one column n rows matrix(-1 means not sure how many row)
</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">"MinMax"</span><span class="p">:</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="n">feature_range</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">"Z-Score"</span><span class="p">:</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"only support MinMax scaler and Z-Score scaler"</span><span class="p">)</span>
    <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># scaler transform apply to each column respectively
</span>    <span class="c1"># (which means that if we want to transform a 1-D data, we must reshape it to n x 1 matrix)
</span>    <span class="k">return</span> <span class="n">scaler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">scaler</span>


<span class="k">def</span> <span class="nf">denormalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>
    <span class="s">"""
    denormalize data by scaler
    :param data:
    :param scaler:
    :return: denormalized data
    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># max, min, mean, variance are all store in scaler, so we need it to perform inverse transform
</span>    <span class="k">return</span> <span class="n">scaler</span><span class="p">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="2é‡é‡‡æ ·">2.é‡é‡‡æ ·</h2>

<p>â€ƒâ€ƒæœ‰æ—¶å€™åŸå§‹æ•°æ®çš„é‡‡æ ·é¢‘ç‡å¯èƒ½å¤ªé«˜ï¼Œå¯¼è‡´å™ªå£°æ¯”è¾ƒå¤§ï¼Œé‡é‡‡æ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½å™ªå£°ï¼ŒåŒæ—¶æ•°æ®é‡è¾ƒå¤§çš„æ—¶å€™è¿˜å¯ä»¥èµ·åˆ°å‡å°æ•°æ®é‡æé«˜æ¨¡å‹çš„è¿­ä»£é€Ÿåº¦ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s">"W"</span><span class="p">):</span>
    <span class="s">"""
    resample the original data to reduce noise
    :param data:
    :param period: the period of data e.g. B - business day, D - calendar day, W - weekly, Y - yearly etc.
    (reference: pandas DateOffset Objects'http://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html')
    :return:
    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">.</span><span class="n">resample</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"right"</span><span class="p">).</span><span class="n">mean</span><span class="p">().</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="3æ•°æ®åˆ’åˆ†">3.æ•°æ®åˆ’åˆ†</h2>

<p>â€ƒâ€ƒç”¨äºå°†åŸå§‹æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒæœºï¼Œæµ‹è¯•é›†å’ŒéªŒè¯é›†ï¼Œå¯ä»¥è‡ªè¡Œè°ƒæ•´åˆ†é…æƒé‡ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">split_data</span><span class="p">(</span><span class="n">observed_data</span><span class="p">,</span> <span class="n">split_ratio</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="s">"""
    split the observed data into train-evaluation-test three part
    :param observed_data:
    :param split_ratio: relative proportion among train,evaluation,test
    :return: train, evaluation, test data
    """</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">split_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">split_ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">split_ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">observed_data</span><span class="p">)</span>
    <span class="n">train_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">split_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span><span class="p">)</span>
    <span class="n">test_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">split_ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">observed_data</span><span class="p">[:</span><span class="n">train_cnt</span><span class="p">],</span> <span class="n">observed_data</span><span class="p">[</span><span class="n">train_cnt</span><span class="p">:</span><span class="o">-</span><span class="n">test_cnt</span><span class="p">],</span> <span class="n">observed_data</span><span class="p">[</span><span class="o">-</span><span class="n">test_cnt</span><span class="p">:]</span>
</code></pre></div></div>

<h2 id="4å„ç§æ»¤æ³¢ä¸­å€¼å‡å€¼å·´ç‰¹æ²ƒæ–¯">4.å„ç§æ»¤æ³¢ï¼ˆä¸­å€¼ï¼Œå‡å€¼ï¼Œå·´ç‰¹æ²ƒæ–¯ï¼‰</h2>

<p>â€ƒâ€ƒè¿™ä¸ªä¸»è¦ç”¨äºä¿¡å·å¤„ç†ï¼Œä¸€èˆ¬çš„æ•°æ®åˆ†æå¯èƒ½ç”¨çš„ä¸å¤šã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">median_filter</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="s">"""
    median filter, length must be odd number
    :param datas:
    :param length:
    :return:
    """</span>
    <span class="k">return</span> <span class="n">signal</span><span class="p">.</span><span class="n">medfilt</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">length</span><span class="p">).</span><span class="n">tolist</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">average_filter</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="s">"""
    average filter, length should not greater than 5
    :param datas:
    :param length:
    :return:
    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">datas</span> <span class="o">=</span> <span class="n">datas</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">datas</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">updated</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">average</span><span class="p">([</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">datas</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
            <span class="n">updated</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">average</span><span class="p">([</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">,</span> <span class="n">d4</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">datas</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">3</span><span class="p">:]):</span>
            <span class="n">updated</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">average</span><span class="p">([</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">,</span> <span class="n">d4</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">,</span> <span class="n">d4</span><span class="p">,</span> <span class="n">d5</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">datas</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">datas</span><span class="p">[</span><span class="mi">4</span><span class="p">:]):</span>
            <span class="n">updated</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">average</span><span class="p">([</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">,</span> <span class="n">d4</span><span class="p">,</span> <span class="n">d5</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">updated</span>


<span class="c1"># noinspection PyTupleAssignmentBalance
</span><span class="k">def</span> <span class="nf">butter_filter</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">hc</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="p">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s">"low"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">signal</span><span class="p">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">datas</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="5æ•°æ®å¯è§†åŒ–">5.æ•°æ®å¯è§†åŒ–</h2>

<p>â€ƒâ€ƒæ•°æ®å¯è§†åŒ–ä¹Ÿæ˜¯é¢„å¤„ç†ä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªæ‰‹æ®µï¼Œå¯ä»¥ç”¨äºåˆ†ææ•°æ®çš„å„é¡¹å±æ€§ã€‚</p>

<ul>
  <li>æŠ˜çº¿å›¾ï¼šç”¨äºåˆ†ææ•°æ®çš„å˜åŒ–è¶‹åŠ¿</li>
  <li>ç®±å‹å›¾ï¼šç”¨äºåˆ†ææ•°æ®å¼‚å¸¸å€¼</li>
  <li>æ­£æ€åˆ†å¸ƒå›¾ï¼šç”¨äºåˆ†ææ•°æ®æ˜¯å¦ç¬¦åˆæ­£æ€åˆ†å¸ƒ</li>
  <li>æ•£ç‚¹å›¾ï¼šç”¨äºåˆ†ææ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼ˆçº¿æ€§åº¦ï¼Œèšåˆåº¦ç­‰ï¼‰</li>
  <li>çƒ­åŠ›å›¾ï¼šç”¨äºåˆ†æå¤šç»„æ•°æ®é—´çš„ç›¸å…³ç³»æ•°ï¼ˆæ³¨æ„ï¼Œä¸€å®šæ˜¯å¤šç»„æ•°æ®ï¼‰</li>
  <li>æŸ±çŠ¶å›¾ï¼šç”¨äºåˆ†ææ•°æ®çš„ç›¸å¯¹å¤§å°/å æ¯”</li>
  <li>é¥¼çŠ¶å›¾ï¼šç”¨äºåˆ†ææ•°æ®çš„å æ¯”</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">x_val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x_val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legend</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="c1"># show legend(line label)
</span>        <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># show x label
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="c1"># show y label
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="c1"># show title
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'./result/%s.png'</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">box_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    box plot â€”â€” use to see the distribution of the datas
    :param data: list of data
    :param file_name: file name of the plot figure
    :return: None
    """</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">sym</span><span class="o">=</span><span class="s">"o"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'./result/%s.png'</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">distribution_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    distribution plot â€”â€” use to see the distribution of the data
    :param data: list of data
    :param file_name: file name of the plot figure
    :return: None
    """</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">sns</span><span class="p">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">'whitegrid'</span><span class="p">)</span>
    <span class="n">sns</span><span class="p">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"distribution"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"./result/%s.png"</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">scatter_plot</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">x_val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    scatter plot â€”â€” use to see the distribution of the data
    :param y_val: y value
    :param x_val: x value, if None will use 0 ~ range(len(y_val))
    :param x_label:
    :param y_label:
    :param title:
    :param file_name: file name of the plot figure
    :return: None
    """</span>
    <span class="k">if</span> <span class="n">x_val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'./result/%s.png'</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">heatmap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"pearson"</span><span class="p">):</span>
    <span class="s">"""
    draw the heat map of sets of data
    :param data: DataFrame format
    :param file_name:
    :param method: method used to calculate the correlation
                   pearson - range -1 ~ 1(only two variable in perfect linear relation, it will be Â±1)
                   spearman - range -1 ~ 1(it will be Â±1 when
                   the relation between two variable can be described by a monotonic function)
    reference
    &lt; 0.1 : no relation
    0.10 ~ 0.29: weak relation
    0.30 ~ 0.49: medium relation
    &gt; 0.5: strong relation
    :return: None
    """</span>
    <span class="n">sns</span><span class="p">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">data</span><span class="p">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">),</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">).</span><span class="n">columns</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">).</span><span class="n">columns</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s">'weight'</span><span class="p">:</span> <span class="s">'bold'</span><span class="p">},</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"YlGnBu"</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"./result/heatmap/%s.png"</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">bar_plot</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">x_val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x_val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">x_label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="n">x_val</span>
    <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">tick_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">x_val</span><span class="p">):</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s">'%.0f'</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_val</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span> <span class="n">tick_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">):</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s">'%.0f'</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'./result/%s.png'</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">)</span>
    <span class="c1"># if file_name:
</span>    <span class="c1">#     plt.savefig('./result/%s.png' % file_name, bbox_inches='tight')
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">pie_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""
    draw data in pie figure
    :param data:list(pure data) or dict(use keys as labels and values as data)
    :param labels: None if data is a dict
    :return:
    """</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">labels</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">X</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"labels should be specify"</span><span class="p">)</span>

    <span class="n">plt</span><span class="p">.</span><span class="n">pie</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s">'%1.2f%%'</span><span class="p">)</span>  <span class="c1"># ç”»é¥¼å›¾ï¼ˆæ•°æ®ï¼Œæ•°æ®å¯¹åº”çš„æ ‡ç­¾ï¼Œç™¾åˆ†æ•°ä¿ç•™ä¸¤ä½å°æ•°ç‚¹ï¼‰
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Pie chart"</span><span class="p">)</span>

    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="æ¨¡å‹ç»“æœè¡¡é‡">æ¨¡å‹ç»“æœè¡¡é‡</h2>

<p>â€ƒâ€ƒå½“æœ‰å¤šä¸ªæ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæŒ‡æ ‡è¡¡é‡æ¨¡å‹å»ºè¡¨ç°çš„å¥½åï¼Œé’ˆå¯¹æ—¶é—´åºåˆ—ï¼ˆè¿ç»­ï¼‰ï¼Œå¯ä»¥é€‰å–å‡æ–¹è¯¯å·®ï¼ˆmseï¼‰å’Œå‡æ–¹æ ¹è¯¯å·®ï¼ˆrmseï¼‰ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
    <span class="s">"""
    root-mean-square error
    :param predictions:
    :param targets:
    :return:
    """</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">targets</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">).</span><span class="n">mean</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
    <span class="s">"""
    mean-square error
    :param predictions:
    :param targets:
    :return:
    """</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">targets</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></div>
:ET